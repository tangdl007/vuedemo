{"version":3,"file":"vue.js","sources":["../src/compiler/index.js","../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["//正则表达式\r\nconst ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`;\r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`;\r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`);\r\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`);\r\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/\r\nconst startTagClose = /^\\s*(\\/?)>/;\r\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g;\r\nexport function compileToFunction(template){\r\n    //将template生成ast抽象语法树\r\n    //生成render函数\r\n    //render函数执行的结果就是 虚拟dom\r\n}","//重写数组中的部分方法\r\nlet oldArrayProto = Array.prototype;\r\n\r\nexport let newArrayProto = Object.create(oldArrayProto); //在自己的身上改不在array本身上改变\r\n\r\n\r\n//能够改变array本身的方法\r\nlet methods = [\r\n    \"push\",\r\n    \"pop\",  //移除最后一个元素，并返回该元素\r\n    \"shift\",//删除第一个元素并返回\r\n    \"unshift\",\r\n    \"reverse\",\r\n    \"sort\",\r\n    \"splice\"  //删除添加元素  查询的位置  删除的个数 新增的元素\r\n] //concat slice都不会改变数组本身\r\n\r\n//切片编程  自己实现一个功能 把原有功能放进去  可以追加功能  实现切片编程\r\n\r\n\r\n\r\nmethods.forEach(method => {\r\n    newArrayProto[method] = function(...args){ //实例调用的方法 \r\n        const result = oldArrayProto[method].call(this,...args); //在里面调用this的指向就有问题  切片编程\r\n\r\n        //新增的元素进行属性的劫持\r\n        let inserted;\r\n        let ob = this.__ob__;\r\n        switch (method) {\r\n            case \"push\":\r\n            case \"unshift\":\r\n                inserted = args;\r\n            case \"splice\":\r\n                inserted = args.slice(2);\r\n            default:\r\n                break;\r\n        }\r\n\r\n        if(inserted){\r\n            ob.observeArr(inserted);\r\n        }\r\n\r\n        return result;\r\n    }\r\n})","import { newArrayProto } from \"./array\";\r\n\r\nclass Observer{\r\n    constructor(data){\r\n        //object.defineProperty只能对已经存在的属性进行劫持 对于新增和删除的属性不能进行劫持  $set $delete\r\n        Object.defineProperty(data,\"__ob__\",{\r\n            value:this,\r\n            enumerable:false   //不可枚举 循环取不到\r\n        })\r\n        // data.__ob__ = this; //如果数组有__ob__则说明数据并观测过了   如果是对象的话进入死循环\r\n        //数组的方法进行拦截\r\n        if(Array.isArray(data)){\r\n            this.observeArr(data);\r\n            data.__proto__ = newArrayProto;\r\n        }else{\r\n            this.walk(data)\r\n        }\r\n    }\r\n    walk(data){ //循环对象对属性进行劫持\r\n        //重新定义属性  性能消耗点  这也是为什么换成vue3换成proxy后性能明显提升的原因\r\n        Object.keys(data).forEach(key => defineReactive(data,key,data[key]))\r\n    }\r\n    observeArr(data){\r\n        data.forEach(item => observe(item));   //数组的每一项也要进行属性的劫持\r\n    }\r\n}\r\n\r\n\r\nexport function defineReactive(target,key,value){ //闭包 这里的执行栈并没有被销毁 get和set方法能拿到value\r\n    observe(value);\r\n    Object.defineProperty(target,key,{\r\n        get(){\r\n            return value\r\n        },\r\n        set(newValue){\r\n            if(value === newValue)return;\r\n            value = newValue\r\n        }\r\n    })\r\n}\r\n\r\nexport function observe (data){\r\n    //只对对象进行属性劫持\r\n    if(typeof data !== 'object' || data == null)return;\r\n    \r\n    if(data.__ob__ instanceof Observer)return data.__ob__; //被观测过了 直接return\r\n\r\n    return new Observer(data);\r\n}\r\n\r\n\r\n//深度劫持    一个函数里面调用原来的函数    重写数组的方法并且观察数组中的每一项\r\n\r\n\r\n//数组劫持的核心 就是重写数组的方法 并观察每一项\r\n\r\n//不可枚举  不能循环  不能取值","import { observe } from \"./observe/index.js\";\r\n\r\nexport function initState(vm){\r\n    let opts = vm.$options;\r\n    if(opts.data){\r\n        initData(vm);\r\n    }\r\n}\r\n\r\nfunction Proxy(vm,target,key){\r\n    Object.defineProperty(vm,key,{\r\n        get(){  //取值取_data上的值\r\n            return vm[target][key]\r\n        },\r\n        set(newValue){ //设置值设置_data上的值\r\n            if(newValue === vm[target][key])return;\r\n            vm[target][key] = newValue\r\n        }\r\n    })\r\n}\r\n\r\nfunction initData(vm){\r\n    let data = vm.$options.data;\r\n    data = typeof data === 'function'?data.call(vm):data;  //vm调用的\r\n    vm._data = data;  //在实例上进行属性的劫持\r\n    observe(data);\r\n\r\n    //vm._data上的数据进行代理\r\n\r\n    for(let key in data){\r\n        Proxy(vm,'_data',key)\r\n    }\r\n}\r\n\r\n\r\n//首先初始化数据  vue2 兼容ie9以上  vue3抛弃了ie   proxy进行属性劫持","import { compileToFunction } from \"./compiler\";\r\nimport { initState } from \"./state\";\r\n\r\nexport function initMixin(Vue){\r\n    Vue.prototype._init = function(options){  //原型中的this指的都是实例\r\n        const vm = this;\r\n        vm.$options = options;  //$表示vue里面的变量  将用户的选项挂载到实例上\r\n        //初始化数据\r\n        initState(vm);\r\n\r\n\r\n        if(options.el){\r\n            vm.$mount(options.el);  //实现数据的挂载\r\n        }\r\n    }\r\n\r\n\r\n    Vue.prototype.$mount = function(el){\r\n        const vm = this;\r\n        el = document.querySelector(el);\r\n        let opts = vm.$options;\r\n        if(!opts.render){\r\n            let template\r\n            if(!opts.template && el){\r\n                template = el.outerHTML;\r\n            }else{\r\n                if(el){\r\n                    template = opts.template;\r\n                }\r\n            }\r\n            //先找render 再找template  再找el outerHTML\r\n\r\n            //如果有模板就进行编译\r\n\r\n            if(template){\r\n                const render = compileToFunction(template);\r\n                opts.render = render\r\n            }\r\n        }\r\n        opts.render; //统一成了render方法\r\n    }\r\n}\r\n\r\n\r\n\r\n//初始化  状态初始化  data初始化\r\n","import {initMixin} from \"./init\"\r\n\r\nfunction Vue(options){\r\n    this._init(options)\r\n}\r\n\r\ninitMixin(Vue); //初始化方法   通过方法来进行传递\r\n\r\nexport default Vue;\r\n"],"names":["compileToFunction","template","oldArrayProto","Array","prototype","newArrayProto","Object","create","methods","forEach","method","args","result","call","inserted","ob","__ob__","slice","observeArr","Observer","data","defineProperty","value","enumerable","isArray","__proto__","walk","keys","key","defineReactive","item","observe","target","get","set","newValue","initState","vm","opts","$options","initData","Proxy","_data","initMixin","Vue","_init","options","el","$mount","document","querySelector","render","outerHTML"],"mappings":"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"}